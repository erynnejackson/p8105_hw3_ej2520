---
title: "p8105_hw3_ej2520"
author: "Erynne Jackson"
date: "2024-10-14"
output: github_document
---


```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(p8105.datasets)

knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  fig.width = 8, 
  fig.height = 6, 
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis", 
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

## PROBLEM 1: Inspecting the "ny_noaa" Dataset

```{r Loading Dataset}
data("ny_noaa")
```

This dataset contains 2,595,176 observations and 7 variables. The variables include station id, date, precipitation, snowfall, snow depth, and the minimum and maximum temperatures. Next, we are going to create separate variables for year, month, and day and make are that the variables are in reasonable units. 


0 is the most commonly observed values for snowfall. 

``` {r}
ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))

ny_noaa = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

Now, we are creating a two-panel plot showing the average max temperature in January and July in each station across the years. The mean temperature in January is much lower than the mean temperatures in July. The stations seem to follow similar trends in temperature across the years, in the given month. We do see a few outliers in the late 1980s across January and July. 

```{r}
ny_noaa %>% 
  group_by(id, year, month) %>% 
  filter(month %in% c(1, 7)) %>% 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Mean monthly temperature for each station across years for January and July")

```

Below is the two-panel plot showing the minimum and maximum temperatures for the full dataset and the plot showing the distribution of snowfall values greater than 0 and less than 100 separately by each year. 

```{r}
hex = 
  ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()

ridge = 
  ny_noaa %>% 
  filter(snow < 100, snow > 0) %>%
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges()

hex + ridge

```

## PROBLEM 2: Accelometer Dataset 

```{r Loading and Tidying Participant Demographics}

demo_df = read_csv("nhanes_covar.csv", 
 col_types = cols("numeric", "character", "numeric", "numeric", "character"),
 na = c(".", "NA", ""))|>
  janitor::clean_names() |> 
  rename(SEQN = x1, sex = x1_male, age = x3, BMI = x4, education = x1_less_than_high_school) |>
  filter(age >= 21) |> 
  mutate(
    sex = replace(sex, sex ==1, "male")) |> 
  mutate( 
    sex = replace(sex, sex==2, "female")) |>
  mutate( 
    education = replace(education, education == 1, "Less than high school")) |>
  mutate(
    education = replace(education, education == 2, "High school equivalent")) |> 
  mutate(
    education = replace(education, education ==3, "More than high school"))

  

demo_df <- demo_df[-c(1:4),]

```

Now, we are going to clean and tidy the Accelerometer dataset. 

```{r Accelerometer Dataset}

accel_df = read_csv("nhanes_accel.csv", 
  na = c(".", "NA", "")) |>
  pivot_longer(
    min1:min1440, 
    names_to = "minutes",
    names_prefix = "min", 
    values_to = "MIMS_unit"
  )
```

Merging participant and accelerometer dataset. 
```{r}
anti_join(demo_df, accel_df, by ="SEQN")
anti_join(accel_df, demo_df, by ="SEQN")

gbb_df = 
full_join(demo_df, accel_df, by = "SEQN")
```

Creating table for education by sex and visualization of age distribution for men and women in each education category. 
```{r}

gbb_df |> 
  group_by(sex, education) |> 
  summarize(n_obs = n())


gbb_df |> 
  ggplot(aes( x =education , y = age)) +
  geom_point(alpha = .5) + 
  geom_smooth(se = FALSE) +
  facet_grid(. ~ sex)
 
```

We are creating the total_activity variable and plotting by total activity and age. 
```{r}

total_activity = gbb_df |> 
  group_by(SEQN) |> 
  summarize(total_activity = sum(MIMS_unit, na.rm = TRUE))


gbb_df |>
  group_by(SEQN, education, age,sex) |>
  summarize(total_activity = sum(MIMS_unit, na.rm = TRUE))|>
  ggplot(aes(x = age, y = total_activity, color = sex)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
  facet_grid(~education) 

```
## PROBLEM 3: CITI BIKE

```{r}

jan2020_df = read_csv("Jan 2020 Citi.csv") |> 
  mutate(
    date = "jan2020")
 
jan2024_df = read_csv("Jan 2024 Citi.csv") |> 
  mutate(
    date = "jan2024"
  )

jul2020_df = read_csv("July 2020 Citi.csv") |> 
  mutate(
    date = "jul2020"
  )

jul2024_df = read_csv("July 2024 Citi.csv") |>
  mutate(
    date = "jul2024"
  )

citi_bike_df <- bind_rows(jan2020_df, jan2024_df, jul2020_df, jul2024_df)


```

Below, we created a table showing the total number of rides in each combination of year and month, separating electric bike and classic bike. In January of 2020, there was significantly more classic bike riders than electric bike riders. By July of 2020, the number of electric bike rides increased from 3 to 935 riders. In January 2024, the number of electric riders surpassed the number of classic riders. By July of 2024, the number of electric riders was almost double that of classic riders. 

```{r}

table_bike = citi_bike_df |> 
  group_by(date, rideable_type) |>
  summarise(n_obs = n())

```

Restricting data to starting station in July 2024. 
```{r}

table_pop = citi_bike_df |>
  group_by(date, rideable_type, start_station_name) |> 
  filter(date == "jul2024") |>
  summarise(n_obs = n())

```


